<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>title</title>
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="http://code.highcharts.com/highcharts.js"></script>
    <script type="text/javascript" src="http://code.highcharts.com/modules/data.js"></script>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script type="text/javascript">
    //var dataset = d3.csv("median-age-by-town.csv");

    $(document).ready(function() {

      //Uses d3 to GET csv and conver it to JSON
      d3.csv("median.csv", function (d) {
        //gets selected town from DOM and generates new Chart
          var townSelector = document.getElementById('town-selector')
          makeChart();
          townSelector.addEventListener("change", makeChart, false);

          //gets data from 'median.csv',treated as JSON
          function getData(gender,town) {
            for (i = 0; i < d.length; i++) {
              //conditions for specific Querey of "Most Recent Town Median Age: Male vs Female"
              //Can be easily adjusted within "if" statement condtions
              if (d[i].Town == townSelector.value && d[i].Gender == gender && d[i].Variable == "Median Age" && d[i].Race == "All" && d[i].Year == "2011-2015") {
                var dataSeries =
                {
                  /* Extra Object Data if desired
                  town : d[i].Town,
                  year : d[i].Year,
                  race : d[i].Race,
                  */
                  gender : d[i].Gender,
                  y : +d[i].Value,
                };

              }
            }
            console.log(dataSeries);
            return dataSeries.y;
          }
        //Chart Gen function
        function makeChart () {
          var townselected1 = townSelector.value;
          var dsmale = getData("Male",townselected1);
          var dsfemale = getData("Female",townselected1);
          var chartConfig = {
            chart: {
                type: 'column'
            },
            title: {
                text: 'Average Age per Town: Male vs Female for ' + townselected1
            },
            xAxis: {
                categories: [
                    'Male',
                    'Female'
                ],
                crosshair: true
            },
            yAxis: {
                min: 0,
                title: {
                    text: 'Median Age'
                }
            },
            tooltip: {
                 headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
                 pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
                     '<td style="padding:0"><b>{point.y:.1f} mm</b></td></tr>',
                 footerFormat: '</table>',
                 shared: true,
                 useHTML: true
             },
            plotOptions: {
                column: {
                    pointPadding: 0.2,
                    borderWidth: 0
                }
            },
            series: [{
                data:
                [
                  {y: dsmale, color: 'blue'},
                  {y: dsfemale, color: 'pink'}
                ]

            }],
          };

        Highcharts.chart('container',chartConfig);

      };
    });
  });

    </script>

  </head>
  <body>
    <select id="town-selector">
      <option value="Bethel">Bethel</option>
      <option value="Bridgeport">Bridgeport</option>
      <option value="Brookfield">Brookfield</option>
    </select>
    <div id="container" style="width: 800px; height: 400px; margin: 0 auto">
    </div>
  </body>

</html>
