<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>title</title>
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="http://code.highcharts.com/highcharts.js"></script>
    <script type="text/javascript" src="http://code.highcharts.com/modules/data.js"></script>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script type="text/javascript">
    //var dataset = d3.csv("median-age-by-town.csv");

    $(document).ready(function() {

      //gets selected town from DOM
      var townSelector =  document.getElementById('town-selector');
      townSelector.addEventListener("change", makeChart, false);


        //Uses d3 to GET csv and conver it to JSON
          d3.csv("median.csv", function(json) {
            for (i = 0; i < json.length; i++) {
              //conditions for specific Querey of "Most Recent Town Median Age: Male vs Female"
              //Can be easily adjusted within "if" statement condtions
              if (json[i].Town == townSelector.value && json[i].Gender == "Male" && json[i].Variable == "Median Age" && json[i].Race == "All" && json[i].Year == "2011-2015")
              {
                var dsMale =
                {
                  /* Extra Object Data if desired */
                  town : json[i].Town,
                  year : json[i].Year,
                  race : json[i].Race,
                  gender : json[i].Gender,
                  y : +json[i].Value,
                };
                debugger;
              };
            };
            console.log(dataSeries);
            return dsMale;
          });

        var dsmale = getData("Male",townSelector);
        var dsfemale = getData("Female",townSelector);
          //Chart Gen function (Calls getData method and var townSelector)
          function makeChart (townSelector) {
            //debugger;
            var chartConfig = {
              chart: {
                  type: 'column'
              },
              title: {
                  text: 'Average Age per Town: Male vs Female'
              },
              xAxis: {
                  categories: [
                      'Male',
                      'Female'
                  ],
                  crosshair: true
              },
              yAxis: {
                  min: 0,
                  title: {
                      text: 'Median Age'
                  }
              },
              tooltip: {
                   headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
                   pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
                       '<td style="padding:0"><b>{point.y:.1f} mm</b></td></tr>',
                   footerFormat: '</table>',
                   shared: true,
                   useHTML: true
               },
              plotOptions: {
                  column: {
                      pointPadding: 0.2,
                      borderWidth: 0
                  }
              },
              series: [{
                  data: [dsmale.y,dsfemale.y]

              }],
            };
            Highcharts.chart('container',chartConfig);
          };

          makeChart(townSelector);
        });


    </script>

  </head>
  <body>
    <select id="town-selector">
      <option value="Bethel">Bethel</option>
      <option value="Bridgeport">Bridgeport</option>
      <option value="Brookfield">Brookfield</option>
    </select>
    <div id="container" style="width: 800px; height: 400px; margin: 0 auto">
    </div>
  </body>

</html>
